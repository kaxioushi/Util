package byinterface;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLEncoder;

import javax.swing.JTextArea;

import org.json.JSONObject;

import com.gargoylesoftware.htmlunit.FailingHttpStatusCodeException;
import com.gargoylesoftware.htmlunit.WebClient;

public class Url2infoByinterface {

	public static void main(String[] args) {
		//String txt=getTell("傻逼");
		String txt=getInfoFromInterface("http://www.toutiao.com/a6572381223887307268",null);
		System.out.println(txt);
	}
	private static WebClient client=new WebClient();
	public static String getInfo(String url) {
		try {
			return client.getPage("http://bd-bj.jit.oaqi.com/jit/sitereader/?"+URLEncoder.encode(url, "UTF-8")).getWebResponse().getContentAsString();
		} catch (Exception e) {
			e.printStackTrace();
		} 
		return null;
	}
	//璧版帴鍙� 鑾峰緱閾炬帴淇℃伅
	public static String getUrlInfo(String url) {
		String info=null;
		for(int i=0;i<3;i++) {
			try {
				info=client.getPage("http://smon.oaqi.com/svr/sUrl.jgi?url="+URLEncoder.encode(url, "UTF-8")).getWebResponse().getContentAsString();
				if(info!=null) {
					break;
				}
			} catch (FailingHttpStatusCodeException e) {
				e.printStackTrace();
			} catch (MalformedURLException e) {
				e.printStackTrace();
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		return info;
	}
	
	//璋冪敤鎷嗘ゼ鎺ュ彛  鎷嗘ゼ
	public static String getInfoFromInterface(String url,JTextArea jta1) {
		try {
			String turl="http://smon.oaqi.com/svr/sUrl.jgi?url="+URLEncoder.encode(url, "utf-8");
			@SuppressWarnings("resource")
			WebClient client=new WebClient();
			client.setJavaScriptTimeout(200);
			String info=client.getPage(turl).getWebResponse().getContentAsString();
			JSONObject json=new JSONObject(info);
			if(json.has("siteclass")) {
				//http://ali-bj.jit.oaqi.com/jit/sitereader/wy.base.bbs.cn_com_autohome?http://club.autohome.com.cn/bbs/forum-c-3735-1.html
				return client.getPage("http://ali-bj.jit.oaqi.com/jit/sitereader/"+json.getString("siteclass")+"?"+url).getWebResponse().getContentAsString();
			}
		} catch (Exception e) {
			//jta1.setText(jta1.getText()+e.getMessage()+"\n");
		} 
		for(int i=0;i<5;i++){
			try {
				String turl="http://smon.oaqi.com/svr/sUrl.jgi?url="+URLEncoder.encode(url, "utf-8");
				@SuppressWarnings("resource")
				WebClient client=new WebClient();
				client.setJavaScriptTimeout(200);
				String info=client.getPage(turl).getWebResponse().getContentAsString();
				JSONObject json=new JSONObject(info);
				if(json.has("siteclass")) {
					//http://ali-bj.jit.oaqi.com/jit/sitereader/wy.base.bbs.cn_com_autohome?http://club.autohome.com.cn/bbs/forum-c-3735-1.html
					String txt= client.getPage("http://ali-bj.jit.oaqi.com/jit/sitereader/"+json.getString("siteclass")+"?"+url).getWebResponse().getContentAsString();
				                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      	if(txt!=null){
						return txt;
					}
				}
			} catch (Exception e) {
				//jta1.setText(jta1.getText()+e.getMessage()+"\n");
			} 
		}
		return null;
	} 
	//request payload post璇锋眰  
	//姝ｈ礋闈㈠垎鏋�
	//姝ｈ礋闈㈠垎鏋� post璇锋眰
			public static String getinfo(String txt) {
				for(int i=0;i<4;i++) {
					try {
						URL url=new URL("http://nlp.oaqi.com/nlp/sNpDic.jgi?dic=19&type=");
						HttpURLConnection con = (HttpURLConnection) url.openConnection();
						con.setRequestMethod("POST");
						con.setRequestProperty("Accept", "application/json, text/javascript, */*; q=0.01");
						con.setRequestProperty("Accept-Encoding", "gzip, deflate");
						con.setRequestProperty("Accept-Language", "zh-CN,zh;q=0.9");
						con.setRequestProperty("Connection", "keep-alive");
						con.setRequestProperty("Content-Type", "text/plain; charset=UTF-8");
						con.setRequestProperty("Cookie", "AdminDepartment=; AdminPerm=dd; AdminUserName=%CE%BB%BE%FC%CC%CE; AdminProjMask=%2A; AdminID=1819; AdminLevel=9; adminuid=weijuntao; _sgn=1513595732417");
						con.setRequestProperty("Host", "nlp.oaqi.com");
						con.setRequestProperty("Origin", "http://nlp.oaqi.com");
						con.setRequestProperty("Referer", "http://nlp.oaqi.com/nlp/");
						con.setRequestProperty("User-Agent", "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36");
						//con.setRequestProperty(IJSONReader.JSONCLASSNAME, "nlp.oaqi.com");
						con.setInstanceFollowRedirects(false); 
						con.setDoInput(true);
						con.setDoOutput(true);
						con.connect();
						OutputStream out = con.getOutputStream();
		//				if (false) {//鏄惁瀵规暟鎹� 杩涜鍘嬬缉
		//					out = new GZIPOutputStream(out);
		//				}
						out.write(txt.getBytes("UTF-8"));
						out.flush();
						out.close();
						con.disconnect();
						InputStream in=con.getInputStream();
						BufferedReader bufferedReader = new BufferedReader(
								 new InputStreamReader(in));
						String str=null;
						StringBuffer buff=new StringBuffer();
						while((str=bufferedReader.readLine())!=null) {
							buff.append(str);
						}
						System.out.println(buff.toString());
						return buff.toString();
					} catch (IOException e) {
						e.printStackTrace();
					} catch (Exception e) {
						e.printStackTrace();
					}
				}
				return null;
			}
			//返回其正负面
			public static String gettell(String txt){
				String info=getinfo(txt);
				String fumian="中性";
				if(info!=null){
					try{
						JSONObject json=new JSONObject(info);
						double pv=json.getDouble("pv");
						double nv=json.getDouble("nv");//负面
						if(nv==0) {
							if(pv<0.7) {
								fumian="中性";
							}else {
								fumian="正面";
							}
						}else{
							if((pv/nv)<0.7) {
								fumian="负面";
							}else if((pv/nv)<1.3) {
								fumian="中性";
							}else {
								fumian="正面";
							}
						}
					}catch(Exception e){
						e.printStackTrace();
					}
					
				}
				return fumian;
			}
}
